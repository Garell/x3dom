<!DOCTYPE html>
<html>
	<head>
	    <meta http-equiv='X-UA-Compatible' content='chrome=1'></meta>
	    <meta http-equiv='Content-Type' content='text/html;charset=utf-8'></meta>
		<script type="text/javascript" src="../../x3dom_include.js"></script>

		<script type="text/javascript" src="dat.gui.min.js"></script>

        <script>
            var Controller = function()
            {
                this.roughness = 0.0;
                this.metallic = 0.0;
                this.baseColor = [0.0, 0.0, 0.0];
				this.curEnv = 0;
				this.numEnv = 4;
				this.nextEnvironment = function(){
					this.curEnv = (this.curEnv+1) % this.numEnv;	

					document.getElementById("env"+this.curEnv).setAttribute("bind","true");
					document.getElementById("back"+this.curEnv).setAttribute("bind","true");
				};
            }
            window.onload = function(){
                var controller = new Controller();

                var gui = new dat.gui.GUI();
                gui.add(controller, 'roughness', 0.0, 1.0).step(0.01)
                    .onChange(function(value)
                    {
                        document.getElementById("physMat").setAttribute("roughnessFactor",value);
                    });

                gui.add(controller, 'metallic', 0.0, 1.0).step(0.01)
                    .onChange(function(value)
                    {
                        document.getElementById("physMat").setAttribute("metallicFactor",value);
                    });

				gui.add(controller, 'nextEnvironment');                    

                gui.addColor(controller, 'baseColor')
                    .onChange(function(value)
                    {
                        var v = value.map(function(x){return x/255.0}).join(" ");
                        console.log(v);
                        document.getElementById("physMat").setAttribute("albedoFactor",v);
                    });

            }
        </script>
	</head>
	<body>
		<x3d id="x3d" style="width:100%;height:100%;">
			<scene>
				<PhysicalEnvironmentLight id="env0" bind="true" genLevel="10">
					<ComposedCubeMapTexture containerfield="diffuse" >
						<ImageTexture url="./envMap/posx.jpg" containerfield="right"></ImageTexture>
						<ImageTexture url="./envMap/negx.jpg" containerfield="left"></ImageTexture>

						<ImageTexture url="./envMap/posy.jpg" containerfield="top"></ImageTexture>
						<ImageTexture url="./envMap/negy.jpg" containerfield="bottom"></ImageTexture>

						<ImageTexture url="./envMap/posz.jpg" containerfield="front"></ImageTexture>
						<ImageTexture url="./envMap/negz.jpg" containerfield="back"></ImageTexture>
					</ComposedCubeMapTexture>
				</PhysicalEnvironmentLight>
				<PhysicalEnvironmentLight id="env1" bind="false" genLevel="10">
					<ComposedCubeMapTexture containerfield="diffuse" >
						<ImageTexture url="./envMap2/posx.jpg" containerfield="right"></ImageTexture>
						<ImageTexture url="./envMap2/negx.jpg" containerfield="left"></ImageTexture>

						<ImageTexture url="./envMap2/posy.jpg" containerfield="top"></ImageTexture>
						<ImageTexture url="./envMap2/negy.jpg" containerfield="bottom"></ImageTexture>

						<ImageTexture url="./envMap2/posz.jpg" containerfield="front"></ImageTexture>
						<ImageTexture url="./envMap2/negz.jpg" containerfield="back"></ImageTexture>
					</ComposedCubeMapTexture>
				</PhysicalEnvironmentLight>
				<PhysicalEnvironmentLight id="env2" bind="false" genLevel="10">
					<ComposedCubeMapTexture containerfield="diffuse" >
						<ImageTexture url="./envMap3/posx.jpg" containerfield="right"></ImageTexture>
						<ImageTexture url="./envMap3/negx.jpg" containerfield="left"></ImageTexture>

						<ImageTexture url="./envMap3/posy.jpg" containerfield="top"></ImageTexture>
						<ImageTexture url="./envMap3/negy.jpg" containerfield="bottom"></ImageTexture>

						<ImageTexture url="./envMap3/posz.jpg" containerfield="front"></ImageTexture>
						<ImageTexture url="./envMap3/negz.jpg" containerfield="back"></ImageTexture>
					</ComposedCubeMapTexture>
				</PhysicalEnvironmentLight>
				<PhysicalEnvironmentLight id="env3" bind="false">
					<ComposedCubeMapTexture containerfield="diffuse" >
						<ImageTexture url="./envMap4/posx.jpg" containerfield="right"></ImageTexture>
						<ImageTexture url="./envMap4/negx.jpg" containerfield="left"></ImageTexture>

						<ImageTexture url="./envMap4/posy.jpg" containerfield="top"></ImageTexture>
						<ImageTexture url="./envMap4/negy.jpg" containerfield="bottom"></ImageTexture>

						<ImageTexture url="./envMap4/posz.jpg" containerfield="front"></ImageTexture>
						<ImageTexture url="./envMap4/negz.jpg" containerfield="back"></ImageTexture>
					</ComposedCubeMapTexture>
				</PhysicalEnvironmentLight>
				<!--<shape>
					<Appearance>
						<PhysicalMaterial id="physMat" roughnessFactor="0.0" albedoFactor="1.0 1.0 1.0" metallicFactor="1.0" >							
							<ImageTexture url="./cerberus/Cerberus_A.png" containerfield="albedoMap" />
						</PhysicalMaterial>
					</Appearance>
					<Sphere />
				</shape>-->
				<Transform rotation="0 0 1 1.57" >
					<Transform rotation="0 1 0 1.57" >
						<inline url="./cerberus/Cerberus_LP.x3d" />
					</Transform>
				</Transform>				
				<Background id="back1" bind="false" isActive="false" leftUrl="./envMap2/negx.jpg" rightUrl="./envMap2/posx.jpg" topUrl="./envMap2/posy.jpg" bottomUrl="./envMap2/negy.jpg" frontUrl="./envMap2/posz.jpg" backUrl="./envMap2/negz.jpg"/>
				<Background id="back2" bind="false" isActive="false" leftUrl="./envMap3/negx.jpg" rightUrl="./envMap3/posx.jpg" topUrl="./envMap3/posy.jpg" bottomUrl="./envMap3/negy.jpg" frontUrl="./envMap3/posz.jpg" backUrl="./envMap3/negz.jpg"/>
				<Background id="back3" bind="false" isActive="false" leftUrl="./envMap4/negx.jpg" rightUrl="./envMap4/posx.jpg" topUrl="./envMap4/posy.jpg" bottomUrl="./envMap4/negy.jpg" frontUrl="./envMap4/posz.jpg" backUrl="./envMap4/negz.jpg"/>
				<Background id="back0" bind="true" isActive="true" leftUrl="./envMap/negx.jpg" rightUrl="./envMap/posx.jpg" topUrl="./envMap/posy.jpg" bottomUrl="./envMap/negy.jpg" frontUrl="./envMap/posz.jpg" backUrl="./envMap/negz.jpg"/>				
			</scene>
		</x3d>
	</body>
</html>